<div dir="rtl">

### 1. تفاوت reference-type بودن `map` و `slice` در Go چه تأثیری در طراحی API دارد؟
(چه زمانی map را return کنیم و چه زمانی نباید؟)

#### پاسخ خلاصه:
در Go، هم `map` و هم `slice` از نوع reference-type هستند. یعنی هنگام return یا ارسال به توابع، فقط آدرس آن‌ها منتقل می‌شود، نه یک کپی از داده. این موضوع می‌تواند باعث بروز تغییرات ناخواسته در داده‌ها (side-effect) شود، مخصوصاً اگر caller یا callee داده را تغییر دهد.

#### تحلیل:
1. `map` ها همیشه mutable هستند حتی زمانی که به ظاهر فقط خوانده می‌شوند.

<div dir="ltr">

```go
func GetSettings() map[string]string {
    return map[string]string{"env": "prod"}
}

s := GetSettings()
s["env"] = "dev"
```
</div>

2. استفاده از `map` به عنوان shared state میان goroutineها می‌تواند منجر به data race شود، مگر اینکه از مکانیزم‌های sync (مثل `sync.Mutex`) استفاده شود.

3. با این حال، return کردن map در برخی موقعیت‌ها مفید است:
- زمانی که نیاز به قابلیت اصلاح یا گسترش map در سمت caller دارید
- زمانی که performance مهم است و نمی‌خواهید کپی‌های غیرضروری گرفته شود

#### پیشنهاد طراحی:

| سناریو              | پیشنهاد                                                                 |
|----------------------|--------------------------------------------------------------------------|
| نیاز فقط به خواندن   | کپی از map تهیه کرده و return کنید                                     |
| نیاز به کنترل بیشتر | از struct با methodهای کنترل‌شده برای مدیریت دسترسی به map استفاده کنید |
| حساس به performance | map را مستقیم return کنید ولی در مستندات عواقب احتمالی را توضیح دهید   |


</div>